{% extends "kodverk_partial_result.html" %}
{% load static %}

{% block mitten-span %}

{% if kodverk_full %}

            
            <table id="komplett_metadata_tabell" class="table table-bordered">
            <tbody>
                    <tr>
                        <td>Kodverk</td>
                        <td>{{kodverk_full.titel_på_kodverk}}</td>
                    </tr>
                    <tr>
                        <td>Syfte</td>
                        <td>{{kodverk_full.syfte}}</td>
                    </tr>
                    <tr>
                        <td>Beskrivning av informationsbehov</td>
                        <td>{{kodverk_full.beskrivning_av_informationsbehov}}</td>
                    </tr>
                    <tr>
                        <td>Kategori</td>
                        <td>{{kodverk_full.kategori}}</td>
                    </tr>
                    <tr>
                        <td>Kodverk variant</td>
                        <td>{{kodverk_full.koverk_variant}}</td>
                    </tr>
                    <tr>
                        <td>Datum skapat</td>
                        <td>{{kodverk_full.datum_skapat}}</td>
                    </tr>
                    <tr>
                        <td>Mappning för rapportering</td>
                        <td>{{kodverk_full.mappning_för_rapportering}}</td>
                    </tr>
                    <tr>
                        <td>Ägare till kodverk</td>
                        <td>{{kodverk_full.ägare_till_kodverk}}</td>
                    </tr>
                    <tr>
                        <td>Giltig från</td>
                        <td>{{kodverk_full.giltig_från}}</td>
                    </tr>
                    <tr>
                        <td>Giltig tom</td>
                        <td>{{kodverk_full.giltig_tom}}</td>
                    </tr>
                    <tr>
                        <td>Senaste ändring</td>
                        <td>{{kodverk_full.senaste_ändring}}</td>
                    </tr>
                    <tr>
                        <td>Ansvarig förvaltare</td>
                        <td>{{kodverk_full.ansvarig_förvaltare}}</td>
                    </tr>
                
                    <!-- <tr>
                        <td>Verifierad användning</td>
                        <td>{% for domän in domän_full %}
                        - {{domän.domän_namn}}<br>
                        {% endfor %}
                    </td>
                    </tr> -->

                <tr>
                    <td><button class="btn btn-warning" style="font-family: frutiger; background-color: #f2a900;" id="opponera_button">Kommentera</button></td>
                    <td><button class="btn btn-success" style="font-family: frutiger; background-color: #4a773c;" id="bekräfta_button">Verifiera användning</button><button type="button" style="float:right;font-family:frutiger; background-color:#006298;"  class="btn btn-info" data-toggle="modal" data-target="#Comment">Hjälp</button></td>
                    
                </tr>
            </tbody>
        </table>

        <div class="modal fade" id="Comment" role="dialog">
            <div class="modal-dialog">		  
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">				
                  <h4 class="modal-title" style="font-family: frutiger;">Instruktioner för Verifiera/kommentera</h4>
                </div>
                <div class="modal-body">
                  <h4 style="font-family: frutiger;">Kommentera begrepp</h4>
                  <p style="font-family: Calibri;">
                    Funktionen Kommentera är tänkt att vara en möjlighet att framföra synpunkter om ett begrepp, hur och var det används eller om det finns felaktigheter. Man kan också ange synonyma termer som kan vara aktuella, ev översättning m m. Det är viktigt att kommentaren tydligt anger vad som avses samt motiveras på ett adekvat sätt. Ange även den kontext som din kommentar gäller. Kommentarerna kommer sedan bearbetas av BegreppsByrån. <br>Gör så här:<br>
                    <ul style="font-family: Calibri;"><li>1.	Tryck på knappen Kommentera</li><li>
                    2.	Fyll i kontaktuppgifter men namn, E-post och telefon så att vi kan nå dig för att ställa frågor.</li><li>
                    3.	Avge dina kommentarer om begreppet. Var så tydlig du kan! </li><li>
                    4.	Tryck på Skicka</li> </ul> <br></p>
                    <h4 style="font-family: frutiger;">Verifiera användning</h4><p style="font-family: Calibri;">
                Funktionen Verifiera användning ska användas för att visa information om var i verksamheten ett begrepp används. Det är således viktigt att de som söker och använder ett begrepp verifierar detta med denna funktion.<br>Gör så här:<br>
               <ul style="font-family: Calibri;">
                <li>1   . När du sökt och funnit ett begrepp som motsvarar ert behov tryck på knappen Verifiera användning</li>
                <li>2.   Fyll i E-postadress</li>
                <li>3.   Välj ett användningsområde i listan Verifierar att begreppet används i.</li>
                <li>3.1.     Finns inte det avsedda användningsområdet i listan, välj Annan.</li>
                <li>3.2.     Skriv sedan i ett nytt användningsområde i fältet Om annat.</li>
                <li>4.  Tryck på Skicka</li></ul></p>
                    
                    </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">stäng</button>
                </div>
              </div>			
            </div>
          </div>

        <table id="kodtext_tabell" name="kodtext_tabell" class="display" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>Kod</th>
                    <th>Kodtext</th>
                    <th>Annan kodtext</th>
                    <th>Definition</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th></th>
                    <th>Kod</th>
                    <th>Kodtext</th>
                    <th>Annan kodtext</th>
                    <th>Definition</th>
                </tr>
            </tfoot>
        </table>
    
{% else %}
        <p>Ingen definition hittades...</p>
{% endif %}

{% endblock mitten-span %}

{% block extra_javascript %}
{{ super }}

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" media="screen">

<script>

/* Formatting function for row details - modify as you need */

function format (d) {
    // `d` is the original data object for the row
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
        '<tr>'+
            '<td>Kod:</td>'+
            '<td>'+d.kod+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Kodtext:</td>'+
            '<td>'+d.kodtext+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Annan kodtext:</td>'+
            '<td>'+d.annan_kodtext+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>Definition:</td>'+
            '<td>'+d.definition+'</td>'+
        '</tr>'+
    '</table>';
};

function get_json_data(term_id) {
    
    var json_data = $.ajax({
                type: "GET",
                dataType: "json",
                url: '/kodtext_json/?q='+term_id,
                success: function(data,textStatus,jqXHR) {
                    console.log('JSON loaded successfully, statusCode =', textStatus);
                },
                complete : function(data,textStatus,jqXHR) {
                    console.log('JSON request complete, statusCode =', textStatus);
                    
                },
                fail : function(data,textStatus,jqXHR) {        
                    $('#mitten-span-middle-column').html("Fel - Hoppsan! Jag får ingen kodtext från servern");
                }
    });    
    return json_data;
};

 function instantiate_table() {

    var data = get_json_data('{{kodverk_id}}')
    var table = $('#kodtext_tabell').DataTable( {
        "retrieve": true,
        "ajax": data.responseJSON,
        "columns": [
            {
                "className": 'details-control',
                "orderable": false,
                "data": '',
                "defaultContent": 'Inga data'
            },
            { 'data' : "fields.kod" },
            { 'data' : "fields.kodtext" },
            { 'data' : "fields.annan_kodtext"},
            { 'data' : "fields.definition" }
        ],
        "order": [[1, 'asc']]
    } )
    return data.responseJSON;
};

 // Add event listener for opening and closing details
 $('#kodtext_tabell tbody').on('click', 'td.details-control', function () {
     var tr = $(this).closest('tr');
     var row = table.row( tr );

     if ( row.child.isShown() ) {
         // This row is already open - close it
         row.child.hide();
         tr.removeClass('shown');
     }
     else {
         // Open this row
         row.child( format(row.data()) ).show();
         tr.addClass('shown');
     }
 } );



</script>

{% endblock extra_javascript %}

